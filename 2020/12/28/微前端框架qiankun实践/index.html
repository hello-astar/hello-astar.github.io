<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>微前端框架qiankun实践 | Astar's Blog</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="Astar"><meta name="designer" content="minfive"><meta name="keywords" content="astar, astar blog, 前端, 前端开发, 全栈开发, javascript, node.js, 程序员, web"><meta name="description" content="日常学习与兴趣交流的个人博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><link rel="canonical" href="http://example.com/2020/12/28/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6qiankun%E5%AE%9E%E8%B7%B5/index.html"><link rel="icon" type="image/png" href="/img/avatar.jpg" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="Astar" type="application/atom+xml"><link rel="stylesheet" href="/scss/views/page/post.css"><meta name="generator" content="Hexo 5.3.0"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/img/loading.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="Astar" alt="Astar"><img src="/img/avatar.jpg" alt="Astar"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"></div><header class="post__info"><h1 class="post__title">微前端框架qiankun实践</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a target="_blank" rel="noopener" href="https://github.com/hello-astar">Astar</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2020-12-28</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/qiankun/">Qiankun</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><h3 id="如果你面临以下问题，可以考虑微前端"><a href="#如果你面临以下问题，可以考虑微前端" class="headerlink" title="如果你面临以下问题，可以考虑微前端"></a>如果你面临以下问题，可以考虑微前端</h3><ol><li>随着新业务的快速扩张，项目出现爆炸发展的问题，项目管理和协同开发的难度在不断上升。</li><li>随着项目文件越来越多，开发、构建、部署速度越来越慢，开发体验持续下降。</li><li>一个小改动却要全量打包，导致用户在一定时间内无法使用应用的其他功能，用户体验下降。</li><li>技术开发人员想要在新的项目中尝试不同的技术栈，一方面可摆脱老项目的沉重和技术陈旧问题，一方面可学习新的技术，提升自我，但产品要求无痛迁移（用户无感）、分批迁移（大版本迭代总可能出现奇奇怪怪的问题）或部分迁移（保留老项目部分内容，且所有新迭代都将在新项目中开发）。</li></ol><h3 id="那么什么是微前端？"><a href="#那么什么是微前端？" class="headerlink" title="那么什么是微前端？"></a>那么什么是微前端？</h3><blockquote><p>微前端（Micro-Frontends）是一种类似于微服务的架构，它将微服务的理念应用于浏览器端，即将 Web 应用由单一的单体应用转变为多个小型前端应用聚合为一的应用。各个前端应用还可以独立运行、独立开发、独立部署。微前端不是单纯的前端框架或者工具，而是一套架构体系。</p></blockquote><h3 id="Why-Not-Iframe"><a href="#Why-Not-Iframe" class="headerlink" title="Why Not Iframe"></a><a target="_blank" rel="noopener" href="https://www.yuque.com/kuitos/gky7yw/gesexv">Why Not Iframe</a></h3><h3 id="关于qiankun"><a href="#关于qiankun" class="headerlink" title="关于qiankun"></a><a target="_blank" rel="noopener" href="https://qiankun.umijs.org/zh/guide">关于qiankun</a></h3><blockquote><p>qiankun是一个基于single-spa的微前端实现库，旨在帮助大家能更简单、无痛的构建一个生产可用微前端架构系统。<br>微前端架构具备以下几个核心价值：</p><ul><li>技术栈无关<br>主框架不限制接入应用的技术栈，微应用具备完全自主权</li><li>独立开发、独立部署<br>微应用仓库独立，前后端可独立开发，部署完成后主框架自动完成同步更新</li><li>增量升级<br>在面对各种复杂场景时，我们通常很难对一个已经存在的系统做全量的技术栈升级或重构，而微前端是一种非常好的实施渐进式重构的手段和策略</li><li>独立运行时<br>每个微应用之间状态隔离，运行时状态不共享</li></ul></blockquote><blockquote><p>微前端架构旨在解决单体应用在一个相对长的时间跨度下，由于参与的人员、团队的增多、变迁，从一个普通应用演变成一个巨石应用(Frontend Monolith)后，随之而来的应用不可维护的问题。这类问题在企业级 Web 应用中尤其常见。</p></blockquote><h3 id="qiankun实践微前端"><a href="#qiankun实践微前端" class="headerlink" title="qiankun实践微前端"></a>qiankun实践微前端</h3><p>以下使用vue项目为主应用、vue和react项目为子应用构建qiankun demo。</p><h4 id="1-创建一个新项目qiankun-demo"><a href="#1-创建一个新项目qiankun-demo" class="headerlink" title="1. 创建一个新项目qiankun-demo"></a>1. 创建一个新项目qiankun-demo</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir qiankun-demo</span><br><span class="line">npm init</span><br></pre></td></tr></table></figure><h4 id="2-在该目录内构建主应用main-vue项目-和子应用micro-vue和micro-react-vue项目和react项目"><a href="#2-在该目录内构建主应用main-vue项目-和子应用micro-vue和micro-react-vue项目和react项目" class="headerlink" title="2. 在该目录内构建主应用main(vue项目)和子应用micro-vue和micro-react(vue项目和react项目)"></a>2. 在该目录内构建主应用main(vue项目)和子应用micro-vue和micro-react(vue项目和react项目)</h4><p>我使用vue create和create-react-app创建的项目<br>并且为两个子应用配上了路由（vue-router和react-router-dom）</p><h4 id="3-配置主应用main"><a href="#3-配置主应用main" class="headerlink" title="3. 配置主应用main"></a>3. 配置主应用main</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd main</span><br><span class="line">npm install --save qiankun</span><br></pre></td></tr></table></figure><p>在主应用中注册qiankun，src目录下添加qiankun.js文件，配置qiankun的启动项，我的配置如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">import &#123;</span><br><span class="line">  registerMicroApps,</span><br><span class="line">  addGlobalUncaughtErrorHandler,</span><br><span class="line">  start,</span><br><span class="line">  initGlobalState,</span><br><span class="line">  setDefaultMountApp</span><br><span class="line">&#125; from &#39;qiankun&#39;</span><br><span class="line"></span><br><span class="line">export default function () &#123;</span><br><span class="line">  &#x2F;&#x2F; 注册子应用</span><br><span class="line">  registerMicroApps([</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#39;micro-vue&#39;, &#x2F;&#x2F; 微应用的名称，微应用之间必须确保唯一</span><br><span class="line">      entry: &#39;&#x2F;&#x2F;localhost:2001&#39;, &#x2F;&#x2F; 微应用的入口</span><br><span class="line">      container: &#39;#subapp-viewport&#39;, &#x2F;&#x2F; 微应用的容器节点的选择器或者 Element 实例（此处表示渲染于主应用的subapp-viewport容器内）</span><br><span class="line">      activeRule: &#39;&#x2F;vue&#39;, &#x2F;&#x2F; 微应用的激活规则，浏览器 url 发生变化会调用 activeRule 里的规则，activeRule 任意一个返回 true 时表明该微应用需要被激活。</span><br><span class="line">      props: &#123; &#x2F;&#x2F; 主应用需要传递给微应用的数据</span><br><span class="line">        test: &#39;props to vue: 给vue子项目的props&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      name: &#39;micro-react&#39;,</span><br><span class="line">      entry: &#39;&#x2F;&#x2F;localhost:2002&#39;,</span><br><span class="line">      container: &#39;#subapp-viewport&#39;, &#x2F;&#x2F; 可为子应用分配不同的container，本次将不示例</span><br><span class="line">      activeRule: &#39;&#x2F;react&#39;,</span><br><span class="line">      props: &#123; &#x2F;&#x2F; 主应用需要传递给微应用的数据</span><br><span class="line">        test: &#39;props to react: 给react子项目的props&#39;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &#x2F;&#x2F; LifeCycles，注册微应用的基础配置信息。当浏览器 url 发生变化时，会自动检查每一个微应用注册的 activeRule 规则，符合规则的应用将会被自动激活</span><br><span class="line">  &#123;</span><br><span class="line">    beforeLoad: [</span><br><span class="line">      app &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&#39;[LifeCycle] before load %c%s&#39;, &#39;color: green;&#39;, app.name);</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    beforeMount: [</span><br><span class="line">      app &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&#39;[LifeCycle] before mount %c%s&#39;, &#39;color: green;&#39;, app.name);</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    afterMount: [</span><br><span class="line">      app &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&#39;[LifeCycle] after mount %c%s&#39;, &#39;color: green;&#39;, app.name);</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    beforeUnmount: [</span><br><span class="line">      app &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&#39;[LifeCycle] before unmount %c%s&#39;, &#39;color: green;&#39;, app.name);</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    afterUnmount: [</span><br><span class="line">      app &#x3D;&gt; &#123;</span><br><span class="line">        console.log(&#39;[LifeCycle] after unmount %c%s&#39;, &#39;color: green;&#39;, app.name);</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 添加全局的未捕获异常处理器</span><br><span class="line">  addGlobalUncaughtErrorHandler((event) &#x3D;&gt; &#123;</span><br><span class="line">      const &#123; message &#125; &#x3D; event</span><br><span class="line">      &#x2F;&#x2F; 加载失败时提示</span><br><span class="line">      if (message &amp;&amp; message.includes(&#39;died in status LOADING_SOURCE_CODE&#39;)) &#123;</span><br><span class="line">        console.log(&#39;微应用加载失败，请检查应用是否可运行&#39;, event)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 定义全局状态，并返回通信方法，建议在主应用使用，微应用通过 props 获取通信方法</span><br><span class="line">  const actions &#x3D; initGlobalState(&#123; msg: &#39;通过globalstate，大家都可以用&#39; &#125;)</span><br><span class="line">  actions.onGlobalStateChange((state, prev) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&#39;主应用获取到globalState Change&#39;, state, prev)</span><br><span class="line">  &#125;, true)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; actions.setGlobalState(state)</span><br><span class="line"></span><br><span class="line">  setDefaultMountApp(&#39;&#x2F;vue&#39;) &#x2F;&#x2F; 设置主应用启动后默认进入的微应用</span><br><span class="line"></span><br><span class="line">  start()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>当微应用信息注册完之后，一旦浏览器的 url 发生变化，便会自动触发 qiankun 的匹配逻辑，所有 activeRule 规则匹配上的微应用就会被插入到指定的 container 中，同时依次调用微应用暴露出的生命周期钩子。<br>如果微应用不是直接跟路由关联的时候，你也可以选择手动加载微应用的方式：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123; loadMicroApp &#125; from &#39;qiankun&#39;;</span><br><span class="line">loadMicroApp(</span><br><span class="line">  &#123; </span><br><span class="line">    name: &#39;app&#39;, </span><br><span class="line">   	entry: &#39;&#x2F;&#x2F;localhost:7100&#39;,</span><br><span class="line">    container: &#39;#yourContainer&#39;, </span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>在主应用main.js中增加以下内容，启动qiankun</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import startQiankun from &#39;.&#x2F;qiankun&#39;</span><br><span class="line">startQiankun()</span><br></pre></td></tr></table></figure><p>在App.vue中增加容器subapp-viewport用于子应用渲染，router-view用于主应用页面渲染（这意味着我们可以在主应用中自定义路由，除了/vue和/react的路径，其它均走主应用路由渲染）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;subapp-viewport&quot; v-show&#x3D;&quot;!$route.name&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;router-view v-show&#x3D;&quot;$route.name&quot;&gt;&lt;&#x2F;router-view&gt;</span><br></pre></td></tr></table></figure><p>为解决开发环境跨域问题，可按以下内容配置vue.config.js</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: 2000,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39; &#x2F;&#x2F; 解决跨域</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-配置子应用micro-vue和micro-react-子应用不需要额外安装任何其他依赖即可接入-qiankun-主应用"><a href="#4-配置子应用micro-vue和micro-react-子应用不需要额外安装任何其他依赖即可接入-qiankun-主应用" class="headerlink" title="4. 配置子应用micro-vue和micro-react(子应用不需要额外安装任何其他依赖即可接入 qiankun 主应用)"></a>4. 配置子应用micro-vue和micro-react(子应用不需要额外安装任何其他依赖即可接入 qiankun 主应用)</h4><p>子应用配置主要有以下几个步骤：<br>a. 增加<code>&#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;</code>解决开发环境跨域问题<br>b. 在入口js中导出相应的生命周期钩子<br>c. 配置微应用的打包工具</p><ul><li>配置vue子应用micro-vue<br>修改vue.config.js<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">const name &#x3D; require(&#39;.&#x2F;package&#39;).name;</span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  devServer: &#123;</span><br><span class="line">    port: 2001,</span><br><span class="line">    headers: &#123;</span><br><span class="line">      &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39; &#x2F;&#x2F; 解决开发环境跨域问题</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  configureWebpack: &#123; &#x2F;&#x2F; 配置微应用打包工具，让主应用能正确识别微应用暴露出来的一些信息</span><br><span class="line">    output: &#123;</span><br><span class="line">      &#x2F;&#x2F; 微应用的包名，这里与主应用中注册的微应用名称一致$&#123;name&#125;</span><br><span class="line">      library: &#96;$&#123;name&#125;-[name]&#96;,</span><br><span class="line">      &#x2F;&#x2F; 将你的 library 暴露为所有的模块定义下都可运行的方式</span><br><span class="line">      libraryTarget: &#39;umd&#39;,</span><br><span class="line">      &#x2F;&#x2F; 按需加载相关，设置为 webpackJsonp_$&#123;name&#125; 即可</span><br><span class="line">      jsonpFunction: &#96;webpackJsonp_$&#123;name&#125;&#96;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>修改main.js，导出相应的生命周期钩子<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;* eslint-disable no-undef *&#x2F;</span><br><span class="line">import Vue from &#39;vue&#39;</span><br><span class="line">import App from &#39;.&#x2F;App.vue&#39;</span><br><span class="line">import routerConfig from &#39;.&#x2F;router&#x2F;index.js&#39;</span><br><span class="line">import VueRouter from &#39;vue-router&#39;;</span><br><span class="line"></span><br><span class="line">let instance &#x3D; null</span><br><span class="line">let router &#x3D; null</span><br><span class="line"></span><br><span class="line">if (window.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  &#x2F;&#x2F; 动态设置 webpack publicPath，防止资源加载出错</span><br><span class="line">  __webpack_public_path__ &#x3D; window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render (props &#x3D; &#123;&#125;) &#123;</span><br><span class="line">  </span><br><span class="line">  if (props) &#123;</span><br><span class="line">    &#x2F;&#x2F; Vue.prototype.$app &#x3D; props &#x2F;&#x2F; 将props挂在prototype上</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Vue.config.productionTip &#x3D; false</span><br><span class="line">  </span><br><span class="line">  Vue.use(VueRouter)</span><br><span class="line">  router &#x3D; new VueRouter(&#123;</span><br><span class="line">    base: window.__POWERED_BY_QIANKUN__ ? &#39;&#x2F;vue&#39; : &#39;&#x2F;&#39;,</span><br><span class="line">    mode: &#39;history&#39;,</span><br><span class="line">    routes: routerConfig</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  &#x2F;&#x2F; 由于主应用渲染在#app上，为防止换用，增加判断，若使用了qiankun，则将子应用渲染在container下的#app中，若没有使用，则直接渲染在body下的#app中</span><br><span class="line">  &#x2F;&#x2F; 也可以为当前子应用定制一个不同名的渲染位置，但要同时修改子应用index.html和app.vue的id并且保证不跟主应用的id冲突</span><br><span class="line">  const &#123; container &#125; &#x3D; props</span><br><span class="line"></span><br><span class="line">  console.log(props)</span><br><span class="line">  instance &#x3D; new Vue(&#123;</span><br><span class="line">    router,</span><br><span class="line">    render: h &#x3D;&gt; h(App)</span><br><span class="line">  &#125;).$mount(container ? container.querySelector(&#39;#app&#39;) : &#39;#app&#39;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 不存在主应用时可直接单独运行</span><br><span class="line"> *&#x2F;</span><br><span class="line">if (!window.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  render()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * bootstrap 只会在微应用初始化的时候调用一次，下次微应用重新进入时会直接调用 mount 钩子，不会再重复触发 bootstrap。</span><br><span class="line"> * 通常我们可以在这里做一些全局变量的初始化，比如不会在 unmount 阶段被销毁的应用级别的缓存等。</span><br><span class="line"> *&#x2F;</span><br><span class="line">export async function bootstrap () &#123;</span><br><span class="line">  console.log(&#39;[vue] vue app bootstraped&#39;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 应用每次进入都会调用 mount 方法，通常我们在这里触发应用的渲染方法</span><br><span class="line"> *&#x2F;</span><br><span class="line">export async function mount (props) &#123;</span><br><span class="line">  console.log(&#39;[vue] vue app mount&#39;, props.test)</span><br><span class="line">  props.onGlobalStateChange &amp;&amp; props.onGlobalStateChange((state, prev) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(state, prev)</span><br><span class="line">  &#125;, true);</span><br><span class="line">  props.setGlobalState &amp;&amp; props.setGlobalState(&#123; msg: &#39;vue子应用修改globalstate&#39; &#125;)</span><br><span class="line">  render(props)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * 应用每次 切出&#x2F;卸载 会调用的方法，通常在这里我们会卸载微应用的应用实例</span><br><span class="line"> *&#x2F;</span><br><span class="line">export async function unmount () &#123;</span><br><span class="line">  console.log(&#39;[vue] vue app unmount&#39;)</span><br><span class="line">  instance.$destroy()</span><br><span class="line">  instance.$el.innerHTML &#x3D; &#39;&#39;</span><br><span class="line">  instance &#x3D; null</span><br><span class="line">  router &#x3D; null</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li>配置react子应用micro-react<br>安装<a target="_blank" rel="noopener" href="https://github.com/harrysolovay/rescripts">rescripts</a>，用于修改webpack配置<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @rescripts&#x2F;cli</span><br></pre></td></tr></table></figure>修改package.json<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;start&quot;: &quot;rescripts start&quot;,</span><br><span class="line">  &quot;build&quot;: &quot;rescripts build&quot;,</span><br><span class="line">  &quot;test&quot;: &quot;rescripts test&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>在package.json同级目录下增加.rescriptsrc.js文件，内容如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const &#123; name &#125; &#x3D; require(&#39;.&#x2F;package&#39;);</span><br><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const resolve &#x3D; (dir, sourceDir &#x3D; __dirname) &#x3D;&gt; path.join(sourceDir, dir);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">module.exports &#x3D; &#123;</span><br><span class="line">  webpack: config &#x3D;&gt; &#123;</span><br><span class="line">    config.output.library &#x3D; &#96;$&#123;name&#125;-[name]&#96;;</span><br><span class="line">    config.output.libraryTarget &#x3D; &#39;umd&#39;;</span><br><span class="line">    config.output.jsonpFunction &#x3D; &#96;webpackJsonp_$&#123;name&#125;&#96;;</span><br><span class="line">    config.output.globalObject &#x3D; &#39;window&#39;;</span><br><span class="line"></span><br><span class="line">    config.resolve.alias &#x3D; &#123;</span><br><span class="line">      &#39;@&#39;: resolve(&#39;src&#39;),</span><br><span class="line">    &#125;</span><br><span class="line">    return config;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  devServer: config &#x3D;&gt; &#123;</span><br><span class="line">    config.headers &#x3D; &#123;</span><br><span class="line">      &#39;Access-Control-Allow-Origin&#39;: &#39;*&#39;,</span><br><span class="line">    &#125;;</span><br><span class="line">    &#x2F;&#x2F; config.historyApiFallback &#x3D; true;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F; config.hot &#x3D; false;</span><br><span class="line">    &#x2F;&#x2F; config.watchContentBase &#x3D; false;</span><br><span class="line">    &#x2F;&#x2F; config.liveReload &#x3D; false;</span><br><span class="line"></span><br><span class="line">    return config;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>在package.json同级目录下增加.env文件，内容如下，其中<code>PORT=2002</code>和<code>WDS_SOCKET_PORT=2002</code>指定运行的端口号，<code>BROWSER=none</code>表示运行该项目时不会默认打开浏览器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PORT&#x3D;2002</span><br><span class="line">WDS_SOCKET_PORT&#x3D;2002</span><br><span class="line">BROWSER&#x3D;none</span><br></pre></td></tr></table></figure><code>WDS_SOCKET_PORT=2002</code>一定要加，不加主应用会崩，报以下错误<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">webpackHotDevClient.js:60 WebSocket connection to &#39;ws:&#x2F;&#x2F;localhost:2000&#x2F;sockjs-node&#39; failed: Error during WebSocket handshake: Unexpected response code: 200</span><br><span class="line">.&#x2F;node_modules&#x2F;react-dev-utils&#x2F;webpackHotDevClient.js @ webpackHotDevClient.js:60</span><br><span class="line">__webpack_require__ @ bootstrap:856</span><br><span class="line">fn @ bootstrap:150</span><br><span class="line">1 @ index.js:29</span><br><span class="line">__webpack_require__ @ bootstrap:856</span><br><span class="line">checkDeferredModules @ bootstrap:45</span><br><span class="line">webpackJsonpCallback @ bootstrap:32</span><br><span class="line">eval @ universalModuleDefinition:11</span><br><span class="line">webpackUniversalModuleDefinition @ universalModuleDefinition:9</span><br><span class="line">eval @ universalModuleDefinition:10</span><br><span class="line">eval @ main.chunk.js:784</span><br><span class="line">geval @ index.js?50b2:162</span><br><span class="line">exec @ index.js?50b2:179</span><br><span class="line">schedule @ index.js?50b2:217</span><br><span class="line">schedule @ index.js?50b2:222</span><br><span class="line">schedule @ index.js?50b2:222</span><br><span class="line">eval @ index.js?50b2:228</span><br><span class="line">eval @ index.js?50b2:227</span><br></pre></td></tr></table></figure>修改index.js内容，导出相应的生命周期钩子<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">import React from &#39;react&#39;;</span><br><span class="line">import ReactDOM from &#39;react-dom&#39;;</span><br><span class="line">import App from &#39;.&#x2F;App&#39;;</span><br><span class="line">&#x2F;&#x2F; import reportWebVitals from &#39;.&#x2F;reportWebVitals&#39;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (window.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  &#x2F;&#x2F; eslint-disable-next-line no-undef</span><br><span class="line">  __webpack_public_path__ &#x3D; window.__INJECTED_PUBLIC_PATH_BY_QIANKUN__;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function render (props &#x3D; &#123;&#125;) &#123;</span><br><span class="line">  const &#123; container &#125; &#x3D; props;</span><br><span class="line">  ReactDOM.render(&lt;App&#x2F;&gt;, container ? container.querySelector(&#39;#root&#39;) : document.querySelector(&#39;#root&#39;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!window.__POWERED_BY_QIANKUN__) &#123;</span><br><span class="line">  render();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export async function bootstrap () &#123;</span><br><span class="line">  console.log(&#39;[react16] react app boostraped&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export async function mount (props) &#123;</span><br><span class="line">  console.log(&#39;[react16] props from main framework&#39;, props);</span><br><span class="line">  props.onGlobalStateChange &amp;&amp; props.onGlobalStateChange((value, prev) &#x3D;&gt; &#123;</span><br><span class="line">    console.log(&#96;[onGlobalStateChange - $&#123;props.name&#125;]:&#96;, value, prev);</span><br><span class="line">  &#125;, true);</span><br><span class="line">  props.setGlobalState &amp;&amp; props.setGlobalState(&#123; msg: &#39;react16&#39; &#125;);</span><br><span class="line">  render(props);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export async function unmount (props) &#123;</span><br><span class="line">  const &#123; container &#125; &#x3D; props;</span><br><span class="line">  ReactDOM.unmountComponentAtNode(container ? container.querySelector(&#39;#root&#39;) : document.querySelector(&#39;#root&#39;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; ReactDOM.render(</span><br><span class="line">&#x2F;&#x2F;   &lt;React.StrictMode&gt;</span><br><span class="line">&#x2F;&#x2F;     &lt;RouterConfig&gt;&lt;&#x2F;RouterConfig&gt;</span><br><span class="line">&#x2F;&#x2F;   &lt;&#x2F;React.StrictMode&gt;,</span><br><span class="line">&#x2F;&#x2F;   document.getElementById(&#39;root&#39;)</span><br><span class="line">&#x2F;&#x2F; );</span><br><span class="line">&#x2F;&#x2F; If you want to start measuring performance in your app, pass a function</span><br><span class="line">&#x2F;&#x2F; to log results (for example: reportWebVitals(console.log))</span><br><span class="line">&#x2F;&#x2F; or send to an analytics endpoint. Learn more: https:&#x2F;&#x2F;bit.ly&#x2F;CRA-vitals</span><br><span class="line">&#x2F;&#x2F; reportWebVitals();</span><br></pre></td></tr></table></figure><h4 id="5-使用npm-run-all一键安装运行所有项目"><a href="#5-使用npm-run-all一键安装运行所有项目" class="headerlink" title="5. 使用npm-run-all一键安装运行所有项目"></a>5. 使用npm-run-all一键安装运行所有项目</h4>在qiankun-demo目录下，运行以下代码<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev npm-run-all</span><br></pre></td></tr></table></figure>修改qiankun-demo/package.json<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;install&quot;: &quot;npm-run-all --serial install:main install:micro-react install:micro-vue&quot;,</span><br><span class="line">  &quot;serve&quot;: &quot;npm-run-all --parallel serve:*&quot;,</span><br><span class="line">  &quot;install:main&quot;: &quot;cd main &amp;&amp; rm -rf node_modules &amp;&amp; npm install&quot;,</span><br><span class="line">  &quot;install:micro-react&quot;: &quot;cd micro-react &amp;&amp; rm -rf node_modules &amp;&amp; npm install&quot;,</span><br><span class="line">  &quot;install:micro-vue&quot;: &quot;cd micro-vue &amp;&amp; rm -rf node_modules &amp;&amp; npm install&quot;,</span><br><span class="line">  &quot;serve:main&quot;: &quot;cd main &amp;&amp; npm run serve&quot;,</span><br><span class="line">  &quot;serve:micro-react&quot;: &quot;cd micro-react &amp;&amp; npm run start&quot;,</span><br><span class="line">  &quot;serve:micro-vue&quot;: &quot;cd micro-vue &amp;&amp; npm run serve&quot;,</span><br><span class="line">  &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>接下来只需运行<code>npm install</code>即可安装主应用和子应用的package.json中定义的包，只需运行<code>npm run serve</code>即可同时运行主应用和子应用<h4 id="6-自动读取子应用路由配置，生成sidebar"><a href="#6-自动读取子应用路由配置，生成sidebar" class="headerlink" title="6. 自动读取子应用路由配置，生成sidebar"></a>6. 自动读取子应用路由配置，生成sidebar</h4>一般内部系统都有一个左侧菜单栏，用于页面导航，但是由于我们有多个子应用，如果自己维护左侧菜单栏，则每次子应用增肌新页面时，都要手动在左侧菜单栏的配置文件中增加该页面的导航，十分麻烦。<br>我们希望能够自动读取子应用的路由配置文件，在每次<code>npm run serve</code>时生成整合后的菜单栏配置文件。<br>首先，修改qiankun-demo/package.json的serve运行语句<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;serve&quot;: &quot;node .&#x2F;bin&#x2F;start.js &amp;&amp; npm-run-all --parallel serve:*&quot;</span><br></pre></td></tr></table></figure>然后，在qiankun-demo目录下增加bin文件夹，在bin文件夹下增加start.js文件，其内容如下<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; nodejs对es6的支持并不好，像class, import这些关键字，react的jsx都无法使用。但是babel可以将这些都转化为es5。此处讲讲如何在node端使用babel。</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; babel-register可以理解成一个小插件，将es6的东西转成es5，github地址：https:&#x2F;&#x2F;github.com&#x2F;babel&#x2F;babel&#x2F;tree&#x2F;master&#x2F;packages&#x2F;babel-register。</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 使用很简单，只需要在文件中加入</span><br><span class="line">require(&#39;babel-register&#39;) (&#123;</span><br><span class="line">  presets: [ &#39;env&#39; ]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">const fs &#x3D; require(&#39;fs&#39;);</span><br><span class="line">const path &#x3D; require(&#39;path&#39;);</span><br><span class="line">const config &#x3D; [</span><br><span class="line">  &#123;</span><br><span class="line">    name: &#39;micro-vue&#39;,</span><br><span class="line">    activeRule: &#39;&#x2F;vue&#39;</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    name: &#39;micro-react&#39;,</span><br><span class="line">    activeRule: &#39;&#x2F;react&#39;,</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">let content &#x3D; [];</span><br><span class="line"></span><br><span class="line">const createSideMenu &#x3D; () &#x3D;&gt; &#123;</span><br><span class="line">  const tips &#x3D; &#96;&#x2F;&#x2F; $&#123;</span><br><span class="line">    (new Date()).toLocaleString()</span><br><span class="line">  &#125;从bin&#x2F;start.js自动生成&#96;;</span><br><span class="line"></span><br><span class="line">  config.forEach(item &#x3D;&gt; &#123;</span><br><span class="line">    const appRouterConfig &#x3D; require(path.join(__dirname, &#96;..&#x2F;$&#123;item.name&#125;&#x2F;src&#x2F;router&#x2F;appRouterConfig.js&#96;));</span><br><span class="line">    content &#x3D; content.concat(appRouterConfig.default.map(ele &#x3D;&gt; (&#123; name: ele.name, path: item.activeRule + ele.path, meta: ele.meta &#125;)));</span><br><span class="line">  &#125;)</span><br><span class="line">  fs.writeFileSync(path.join(__dirname, &#39;..&#x2F;main&#x2F;src&#x2F;sideMenu.js&#39;), tips + &#39;\n&#39; + &#96;export default $&#123;JSON.stringify(content, null, 2)&#125;\n&#96;.replace(&#x2F;\&quot;&#x2F;g, &quot;\&#39;&quot;));</span><br><span class="line">&#125;</span><br><span class="line">createSideMenu();</span><br></pre></td></tr></table></figure><h4 id="7-其他常见问题"><a href="#7-其他常见问题" class="headerlink" title="7. 其他常见问题"></a>7. <a target="_blank" rel="noopener" href="https://qiankun.umijs.org/zh/faq">其他常见问题</a></h4></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/zwkkkk1/article/details/81564971?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-2.nonecase">如何在 Node.js 中使用 import / export 的三种方法</a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; nodejs对es6的支持并不好，像class, import这些关键字，react的jsx都无法使用。但是babel可以将这些都转化为es5。此处讲讲如何在node端使用babel。</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; babel-register可以理解成一个小插件，将es6的东西转成es5，github地址：https:&#x2F;&#x2F;github.com&#x2F;babel&#x2F;babel&#x2F;tree&#x2F;master&#x2F;packages&#x2F;babel-register。</span><br><span class="line"></span><br><span class="line">require(&#39;babel-register&#39;) (&#123;</span><br><span class="line">  presets: [ &#39;env&#39; ]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><a target="_blank" rel="noopener" href="https://my.oschina.net/u/4390738/blog/4547080">解决vue-router报NavigationDuplicated: Avoided redundant navigation to current location 的问题</a></li><li>react项目每次启动不打开默认浏览器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">BROWSER&#x3D;none</span><br></pre></td></tr></table></figure><h4 id="8-项目地址"><a href="#8-项目地址" class="headerlink" title="8. 项目地址"></a>8. <a target="_blank" rel="noopener" href="https://github.com/hello-astar/qiankun-demo">项目地址</a></h4></li></ul><p>【参考】<br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904142880800775#heading-11">记一次 微前端 qiankun 项目 实践 !!! 防踩坑指南</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904182814605325">体验微前端（qiankun）</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6864430795927502862">微前端原理和实战（single-spa qiankun）</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6856569463950639117">qiankun 微前端实践总结（二）</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000024456492">qiankun 微前端应用实践与部署（三）</a><br><a target="_blank" rel="noopener" href="https://jwchan.cn/_posts/other/qiankun_micro_app2.html">qiankun 微前端应用实践与部署（二）</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904185910018062">qiankun 微前端方案实践及总结</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013655559/article/details/107527135">基于qiankun落地部署微前端爬”坑“记</a></p><div class="post-announce">感谢您的阅读，本文由 <a href="http://example.com">Astar</a> 版权所有。如若转载，请注明出处：Astar（<a href="http://example.com/2020/12/28/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6qiankun%E5%AE%9E%E8%B7%B5/">http://example.com/2020/12/28/%E5%BE%AE%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6qiankun%E5%AE%9E%E8%B7%B5/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2020/12/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E7%AF%87%EF%BC%88%E6%B1%87%E6%80%BB%EF%BC%89/" title="计算机网络基础篇（汇总）"><i class="iconfont icon-prev"></i>计算机网络基础篇（汇总）</a></div><div class="post__prev post__prev--right"><a href="/2021/01/05/react16%E5%9C%A8ie11%E4%B8%8B%E8%BF%90%E8%A1%8C/" title="react16在ie11下运行">react16在ie11下运行<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="回车搜索"> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">日常学习与兴趣交流的个人博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">问题排查</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E8%A7%84%E8%8C%83%E5%8C%96/">规范化</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%92%8C%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">浏览器和计算机网络</a><span class="block-list-count">7</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a><span class="block-list-count">3</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">数据库</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%BE%AE%E5%89%8D%E7%AB%AF/">微前端</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%BB%BA%E7%AB%99/">建站</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/">前端框架</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/js/">js</a><span class="block-list-count">6</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/css/">css</a><span class="block-list-count">3</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2022/03/25/%E5%B8%B8%E7%94%A8git%E5%91%BD%E4%BB%A4/" title="常用git命令"><div class="item__cover"><img src="https://tse1-mm.cn.bing.net/th/id/R-C.47f1d668ae1c74d288e0cb0e822be203?rik=5R%2fXOkoiMWDLKA&riu=http%3a%2f%2fn.sinaimg.cn%2fsinakd20210215ac%2f790%2fw1539h851%2f20210215%2f8e28-kkciesq4857453.png&ehk=6LzXs%2fY4r%2bPpUrQQzgdKSNCNkTFwWg%2bMIRjlJ9BH1Ik%3d&risl=&pid=ImgRaw&r=0" alt="常用git命令"></div><div class="item__info"><h3 class="item__title">常用git命令</h3><span class="item__text">2022-03-25</span></div></a></li><li class="latest-post-item"><a href="/2022/02/24/css%E6%A0%B7%E5%BC%8F%E6%B2%A1%E7%94%9F%E6%95%88%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/" title="css样式没生效问题排查"><div class="item__cover"><img src="https://img2.baidu.com/it/u=3330810392,2639354941&fm=253&fmt=auto&app=138&f=JPEG?w=887&h=500" alt="css样式没生效问题排查"></div><div class="item__info"><h3 class="item__title">css样式没生效问题排查</h3><span class="item__text">2022-02-24</span></div></a></li><li class="latest-post-item"><a href="/2022/01/19/%E5%9B%BE%E7%89%87%E6%87%92%E5%8A%A0%E8%BD%BD%E7%9A%84%E4%B8%A4%E7%A7%8D%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88/" title="图片懒加载的两种实现方案"><div class="item__cover"><img src="https://img2.baidu.com/it/u=4193472195,2353099366&fm=253&fmt=auto&app=138&f=JPEG?w=889&h=500" alt="图片懒加载的两种实现方案"></div><div class="item__info"><h3 class="item__title">图片懒加载的两种实现方案</h3><span class="item__text">2022-01-19</span></div></a></li><li class="latest-post-item"><a href="/2022/01/17/%E5%89%8D%E7%AB%AF%E7%94%9F%E6%88%90CHANGELOG%E6%8C%87%E5%8D%97/" title="前端生成CHANGELOG指南"><div class="item__cover"><img src="https://img1.baidu.com/it/u=1869297395,2506210818&fm=253&fmt=auto&app=138&f=JPEG?w=499&h=281" alt="前端生成CHANGELOG指南"></div><div class="item__info"><h3 class="item__title">前端生成CHANGELOG指南</h3><span class="item__text">2022-01-17</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/css/">css</a></li><li class="tag-item"><a class="tag-link" href="/tags/git/">git</a></li><li class="tag-item"><a class="tag-link" href="/tags/js%E5%9F%BA%E7%A1%80/">js基础</a></li><li class="tag-item"><a class="tag-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-item"><a class="tag-link" href="/tags/nginx/">nginx</a></li><li class="tag-item"><a class="tag-link" href="/tags/qiankun/">qiankun</a></li><li class="tag-item"><a class="tag-link" href="/tags/shell/">shell</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%85%BC%E5%AE%B9ie/">兼容ie</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%B9%B3%E8%A1%A1%E4%BA%8C%E5%8F%89%E6%A0%91/">平衡二叉树</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/">性能优化</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">排序算法</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%9C%80%E9%95%BF%E6%97%A0%E9%87%8D%E5%A4%8D%E5%AD%90%E4%B8%B2/">最长无重复子串</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%A8%A1%E6%8B%9F%E5%AE%9E%E7%8E%B0js/">模拟实现js</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/">正则表达式</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6/">渲染机制</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/">网络基础</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/">自动部署</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%A7%84%E8%8C%83%E5%8C%96/">规范化</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E8%B7%A8%E5%9F%9F/">跨域</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/">问题排查</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">本站是基于Hexo搭建的静态资源博客，主要用于分享日常学习、生活及工作的一些心得总结，欢迎点击右下角订阅 rss。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>ShenZhen, Guangdong Province, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>2320390964@qq.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/img/qrcode.jpg" alt="logo" title="Astar"></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["qiankun"],gitalk=new Gitalk({clientID:"f75b0e86fdac67670255",clientSecret:"ec0d30e74282751b50189f8554788c36de21c86a",repo:"hello-astar.github.io",owner:"hello-astar",admin:["hello-astar"],labels:tags,id:new Date(1609142042e3).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>